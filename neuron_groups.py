from collections import defaultdict
import math
import pandas as pd

rf_trochanter_flexor = [720575941399414563,720575941505568069,720575941450561358,720575941656372304,720575941391252886,720575941504396567,720575941579753849,720575941574013085,
    720575941564818688,720575941623147978,720575941527171000]
rf_trochanter_extensor = [720575941478281440,720575941508453761,720575941593802373,720575941593843589,720575941523368779,720575941411709073,720575941568546418,720575941667380979]
rf_tibia_extensor = [720575941488287797,720575941605019582]
rf_tibia_flexor = [720575941494146176,720575941547393825,720575941526437988,720575941551010695,720575941430029449,720575941453327785,720575941630970604,720575941447846990,720575941559281679,720575941557543918,720575941452885043,720575941590014007,720575941580731001,720575941574167803,720575941623218172,720575941549819710,720575941469045111]
rf_tarsus_depressor = [720575941571652616,720575941496126793,720575941722047290,720575941560573608]
rf_tarsus_levetator = [720575941561433746]
rf_long_tendon = [720575941640958053,720575941592581671,720575941488203209,720575941511197516,720575941501926706,720575941538128626,720575941501044055,720575941524966169]
rf_femur_reductor = [720575941631837856,720575941649909489,720575941608273226,720575941448798133,
    720575941451729274,720575941566924135] # ??????

legs = {
    ("left", "front_leg_motor_neuron"): "lf",
    ("right", "front_leg_motor_neuron"): "rf",
    ("left", "middle_leg_motor_neuron"): "lm",
    ("right", "middle_leg_motor_neuron"): "rm",
    ("left", "hind_leg_motor_neuron"): "lh",
    ("right", "hind_leg_motor_neuron"): "rh",
}

muscles = {
    "trochanter_flexor",
    "trochanter_extensor",
    "tibia_flexor",
    "tibia_extensor",
    "tarsus_depressor",
    "tarsus_levetator",
    "long_tendon",
}

leg_neuron_groups: dict[str, list[int]] = defaultdict(list)

#TODO cache this
banc = pd.read_csv("../flywire/banc_neurons.csv")
for s in banc.iloc:
    cell_class = (s["Soma side"], s["Sub Class"])
    cell_type = s["Primary Cell Type"]
    if s["Class"] == "leg_motor_neuron":
        if cell_class in legs:
            for muscle in muscles:
                if muscle in cell_type:
                    name = legs[cell_class] + "_" + muscle
                    leg_neuron_groups[name].append(s["Root ID"])

print(list(leg_neuron_groups.keys()))
print(set(leg_neuron_groups["rf_trochanter_flexor"]) == set(rf_trochanter_flexor))
print(leg_neuron_groups["rf_trochanter_flexor"], rf_trochanter_flexor)

# missing ones: https://codex.flywire.ai/app/search?dataset=banc&filter_string=super_class+%3D%3D+motor+%26%26+sub_class+%3D%3D+front_leg_motor_neuron+%26%26+side+%3D%3D+right+%26%26+cell_type+%21%3D+tibia_extensor_SETi+%26%26+cell_type+%21%3D+tergopleural_promotor_pleural_promotor_miller_28_30+%26%26+cell_type+%21%3D+accessory_tibia_flexor+%26%26+cell_type+%21%3D+accessory_trochanter_flexor+%26%26+cell_type+%21%3D+trochanter_extensor+%26%26+cell_type+%21%3D+tergotrochanter_extensor+%26%26+cell_type+%21%3D+sternotrochanter_extensor+%26%26+cell_type+%21%3D+tibia_flexor+%26%26+cell_type+%21%3D+tarsus_depressor_B+%26%26+cell_type+%21%3D+trochanter_flexor+%26%26+cell_type+%21%3D+tarsus_levator_D+%26%26+cell_type+%21%3D+tarsus_depressor_retro_tarsus_depressor+%26%26+cell_type+%21%3D+long_tendon_muscle_A+%26%26+cell_type+%21%3D+long_tendon_muscle_B+%26%26+cell_type+%21%3D+tibia_extensor_FETi+%26%26+cell_type+%21%3D+femur_reductor+%26%26+cell_type+%21%3D+femur_reductor_tiny+%26%26+cell_type+%21%3D+long_tendon_muscle_B_femur+%26%26+cell_type+%21%3D+tarsus_depressor_dipalpha_ventralU&sort_by=&page_size=10

rf_leg_motor_neurons = [720575941428654255,720575941605019582,720575941556297811,720575941590014007,720575941494146176,720575941564818688,720575941508453761,720575941593802373,720575941593843589,720575941551010695,720575941571652616,720575941430029449,720575941499964555,720575941559281679,720575941411709073,720575941561433746,720575941391252886,720575941504396567,720575941691007896,720575941524966169,720575941574013085,720575941573215995,720575941631837856,720575941547393825,720575941399414563,720575941592581671,720575941592225831,720575941560573608,720575941579753849,720575941453327785,720575941559978797,720575941353301552,720575941501926706,720575941452885043,720575941488287797,720575941448798133,720575941527171000,720575941722047290,720575941549819710,720575941595712448,720575941505568069,720575941496126793,720575941608273226,720575941523368779,720575941511197516,720575941488203209,720575941447846990,720575941450561358,720575941656372304,720575941623147978,720575941501044055,720575941518204888,720575941478281440,720575941526437988,720575941640958053,720575941531180261,720575941566924135,720575941630970604,720575941557543918,720575941649909489,720575941568546418,720575941538128626,720575941667380979,720575941593715569,720575941636735861,720575941469045111,720575941580731001,720575941451729274,720575941623218172,720575941625808330,720575941574167803]
lf_leg_motor_neurons = [720575941455787245,720575941524365337,720575941501929010,720575941563973174,720575941527847608,720575941481179066,720575941561977088,720575941508205185,720575941479472258,720575941494164864,720575941505660801,720575941553516167,720575941573516296,720575941548546696,720575941460703245,720575941461333648,720575941651501585,720575941435830546,720575941611361811,720575941515355795,720575941411838612,720575941464925462,720575941561204626,720575941551356570,720575941595856540,720575941639506207,720575941506261538,720575941498960546,720575941627155238,720575941668683687,720575941450546857,720575941406488494,720575941408338862,720575941720479034,720575941720492346,720575941545479868,720575941486064962,720575941570833736,720575941642303944,720575941610029642,720575941488205769,720575941524748877,720575941524746573,720575941478577231,720575941511883985,720575941464194902,720575941518133464,720575941542454876,720575941447389277,720575941583323358,720575941583222623,720575941531504357,720575941643180901,720575941489123047,720575941610059238,720575941536923624,720575941532427754,720575941590872171,720575941518851694,720575941516874094,720575941402088304,720575941667370739,720575941568724980,720575941639281525,720575941469052535,720575941621725948,720575941483515389,720575941549009663]
